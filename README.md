# PRM_4_113603_MLOps-P3: DataOps API Prototype

## ğŸ›  Overview

A simple, containerized prototype for a **DataOps API service** that packages and serves raw dataset files used in computational materials science or machine learning pipelines. It mimics calls to an **HPC in the cloud** service and includes:

- A **FastAPI-based API** that bundles files into ZIP archives based on dataset identifiers (`<NC>`, `<ID_RUN>`, `<SUB_RUN>`).
- A **client service** that fetches the ZIP archive via HTTP and extracts it.
- Fully managed via **Docker Compose**, simulating a microservices architecture.

All services are containerized with Docker Compose for reproducibility.

---

## ğŸ“¦ API Endpoints

### ğŸ”¸ **1. Schedule Raw Data Generation**
**POST** `/v1/generate/{nc}`

- Allocates the next available `ID_RUN` for the given nominal composition `NC`.
- Returns:
```json
{
  "nc": "Zr49Cu49Al2",
  "id_run": "21",
  "status": "SCHEDULED"
}
```

---

### ğŸ”¸ **2. Schedule Data Augmentation**
**POST** `/v1/generate/{nc}/{id_run}/augment`

- Adds sub-runs (`1` to `14`) to increase structural diversity for a given `NC` and `ID_RUN`.
- Returns:
```json
{
  "nc": "Zr49Cu49Al2",
  "id_run": "21",
  "status": "SCHEDULED"
}
```

---

### ğŸ”¸ **3. Download Generated Dataset**
**GET** `/v1/generate/{nc}/{id_run}/{sub_run}/download`

- Generates and returns a ZIP archive with the files related to the specified `NC`, `ID_RUN`, and `SUB_RUN`. When called it:
  - Searches the `/data` directory for relevant files.
  - Packages the following into a ZIP archive:
    - DFT input/output files (`.scf.in`, `.scf.out`)
    - Bond strength label files (`ICOHPLIST.lobster`)
    - SOAP descriptor files (`SOAPS.vec`)
  - Returns the ZIP archive via HTTP.

---

### ğŸ”¸ **4. List All Available Runs**
**GET** `/v1/generate/available`

- Returns the full internal database of scheduled runs:
```json
{
  "Zr49Cu49Al2": [
    {
      "id_run": "1",
      "sub_runs": [
        "0",
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "10",
        "11",
        "12",
        "13",
        "14"
      ],
      "run_scheduled_at": "2025-06-02T22:37:00.909889+00:00",
      "sub_runs_scheduled_at": "2025-06-02T22:37:32.323661+00:00"
    },
    {
      "id_run": "2",
      "sub_runs": [
        "0"
      ],
      "run_scheduled_at": "2025-06-02T22:37:03.487842+00:00"
    }
  ]
}
```

---

### ğŸ”¸ **5. Returns the statuses of a specific ID_RUN**
**GET** `/v1/generate/available`

- Returns the statuses of a specific ID_RUN:
```json
{
  "id_run": "1",
  "sub_runs": [
    "0",
    "1",
    "2",
    "3",
    "4",
    "5",
    "6",
    "7",
    "8",
    "9",
    "10",
    "11",
    "12",
    "13",
    "14"
  ],
  "run_scheduled_at": "2025-06-02T22:37:00.909889+00:00",
  "sub_runs_scheduled_at": "2025-06-02T22:37:32.323661+00:00",
  "run_status": "DONE",
  "sub_runs_status": "DONE"
}
```

---

## ğŸ“š API Documentation (Swagger UI)
- Available at: `http://localhost:8000/docs`

---

## ğŸš€ Running the Prototype

### 1ï¸âƒ£ Place input data in the `./data` folder.

### 2ï¸âƒ£ Build and run the services:
```bash
docker-compose up --build
```

### 3ï¸âƒ£ Check the output in:
```
./client_output/
```

- âš ï¸ The DataOps endpoint expects files to be placed in the `./data` folder following the same structure used in https://github.com/aryrfjr/PRM_4_113603:
```
./data/
â”œâ”€â”€ Zr49Cu49Al2/
â”‚   â”œâ”€â”€ zca-th300.dump
â”‚   â””â”€â”€ c/md/lammps/100/21/2000/0/   # DFT outputs here
â”‚       â”œâ”€â”€ Zr49Cu49Al2.scf.in
â”‚       â”œâ”€â”€ Zr49Cu49Al2.scf.out
â”‚       â”œâ”€â”€ ICOHPLIST.lobster
â”‚       â””â”€â”€ (other files)
â”œâ”€â”€ Zr49Cu49Al2-SOAPS/
â”‚   â””â”€â”€ c/md/lammps/100/21/2000/0/SOAPS.vec
```

---

## ğŸ“‚ Volumes
| Container      | Path in Container | Mapped to Host         |
|----------------|--------------------|------------------------|
| dataops-api    | `/data`            | `./data`               |
| data-client    | `/app/output`      | `./client_output`      |

---

## ğŸ”¥ Summary
- Fully containerized, documented, and portable.
- Swagger/OpenAPI documentation autogenerated from FastAPI models and routes.
